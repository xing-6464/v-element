import{d as P,k as m,h as c,a7 as U,y as M,o as i,c as u,J as p,w as g,F as W,G as j,n as v,a0 as b,p as C,b as $}from"./framework.Dcy6uJZY.js";import{d as q,_ as z}from"./Tooltip.vue_vue_type_script_setup_true_lang.BDTi3rf2.js";import{_ as G}from"./Input.vue_vue_type_script_setup_true_lang.BmuMtd3p.js";import{_,i as B}from"./Icon.vue_vue_type_script_setup_true_lang.B3H2jUux.js";import{R as J}from"./RenderVNode.D1EUEb_4.js";const X={key:0,class:"x-select__loading"},Q={key:1,class:"x-select__nodata"},T={key:2,class:"x-select__menu"},Y=["id","onClick"],ie=P({name:"XSelect",__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","update:modelValue","visible-change","clear"],setup(F,{emit:D}){const k=l=>{const t=n.options.find(a=>a.value===l);return t||null},n=F,R=m(()=>n.remote?300:0),d=D,f=k(n.modelValue),h=c(),y=c(),s=c(!1),e=U({inputValue:f?f.label:"",selectedOption:f,mouseHover:!1,loading:!1,highlightIndex:-1});M(()=>n.modelValue,l=>{const t=k(l);Object.assign(e,{inputValue:t?t==null?void 0:t.label:"",selectedOption:t})});const S=l=>{switch(l.key){case"Enter":s.value&&e.highlightIndex>-1&&o.value[e.highlightIndex]?V(o.value[e.highlightIndex]):r(!1),x();break;case"Escape":s.value&&r(!1);break;case"ArrowUp":l.preventDefault(),o.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===0?e.highlightIndex=o.value.length-1:e.highlightIndex--);break;case"ArrowDown":l.preventDefault(),o.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===o.value.length-1?e.highlightIndex=0:e.highlightIndex++);break}},H=m(()=>n.clearable&&e.mouseHover&&e.selectedOption&&e.inputValue.trim()!==""),L={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,fn:({state:l})=>{l.styles.popper.width=`${l.rects.reference.width}px`},phase:"beforeWrite",requires:["computeStyles"]}]},o=c(n.options);M(()=>n.options,l=>{o.value=l});const O=async l=>{if(n.filterable){if(n.filterMethod&&B(n.filterMethod))o.value=n.filterMethod(l);else if(n.remote&&n.remoteMethod&&B(n.remoteMethod)){e.loading=!0;try{o.value=await n.remoteMethod(l)}catch(t){console.error(t),o.value=[]}finally{e.loading=!1}}else o.value=n.options.filter(t=>t.label.includes(l));e.highlightIndex=-1}},E=q(()=>{O(e.inputValue)},R.value),N=m(()=>n.filterable&&e.selectedOption&&s.value?e.selectedOption.label:n.placeholder),A=()=>{},K=()=>{e.selectedOption=null,e.inputValue="",d("clear"),d("change",""),d("update:modelValue","")},r=l=>{l?(n.filterable&&e.selectedOption&&(e.inputValue=""),n.filterable&&O(e.inputValue),h.value.show()):(h.value.hide(),n.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:""),e.highlightIndex=-1),s.value=l,d("visible-change",l)},x=()=>{n.disabled||(s.value?r(!1):r(!0))},V=l=>{var t;l.disabled||(e.inputValue=l.label,e.selectedOption=l,d("change",l.value),d("update:modelValue",l.value),r(!1),(t=y.value)==null||t.ref.focus())};return(l,t)=>(i(),u("div",{class:v(["x-select",{"is-disabled":l.disabled}]),onClick:x,onMouseenter:t[2]||(t[2]=a=>e.mouseHover=!0),onMouseleave:t[3]||(t[3]=a=>e.mouseHover=!1)},[p(z,{placement:"bottom-start",ref_key:"tooltipRef",ref:h,"popper-options":L,onClickOutside:t[1]||(t[1]=a=>r(!1)),manual:""},{content:g(()=>[e.loading?(i(),u("div",X,[p(_,{icon:"spinner",spin:""})])):l.filterable&&o.value.length===0?(i(),u("div",Q," no matching data ")):(i(),u("ul",T,[(i(!0),u(W,null,j(o.value,(a,w)=>{var I;return i(),u("li",{key:w,class:v(["x-select__menu-item",{"is-disabled":a.disabled,"is-selected":((I=e.selectedOption)==null?void 0:I.value)===a.value,"is-highlighted":e.highlightIndex===w}]),id:`select-item-${a.value}`,onClick:b(ee=>V(a),["stop"])},[p(C(J),{"v-node":l.renderLabel?l.renderLabel(a):a.label},null,8,["v-node"])],10,Y)}),128))]))]),default:g(()=>[p(G,{ref_key:"inputRef",ref:y,modelValue:e.inputValue,"onUpdate:modelValue":t[0]||(t[0]=a=>e.inputValue=a),disabled:l.disabled,placeholder:N.value,readonly:!l.filterable||!s.value,onInput:C(E),onKeydown:S},{suffix:g(()=>[H.value?(i(),$(_,{key:0,icon:"circle-xmark",class:"x-input__clear",onClick:b(K,["stop"]),onMousedown:b(A,["prevent"])})):(i(),$(_,{key:1,icon:"angle-down",class:v(["header-angle",{"is-active":s.value}])},null,8,["class"]))]),_:1},8,["modelValue","disabled","placeholder","readonly","onInput"])]),_:1},512)],34))}});export{ie as _};
